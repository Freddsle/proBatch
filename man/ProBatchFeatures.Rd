% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ProBatchFeatures copy.R, R/ProBatchFeatures.R
\name{ProBatchFeatures}
\alias{ProBatchFeatures}
\title{Construct a ProBatchFeatures object from a wide matrix + sample annotation.}
\usage{
ProBatchFeatures(
  data_matrix,
  sample_annotation = NULL,
  sample_id_col = "FullRunName",
  name = NULL,
  level = "feature"
)

ProBatchFeatures(
  data_matrix,
  sample_annotation = NULL,
  sample_id_col = "FullRunName",
  name = NULL,
  level = "feature"
)
}
\arguments{
\item{data_matrix}{numeric matrix (features x samples)}

\item{sample_annotation}{data.frame with sample metadata (rows = samples)}

\item{sample_id_col}{character(1), column in sample_annotation that matches colnames(data_matrix)
If missing, rownames(sample_annotation) are used.}

\item{name}{character(1), optional; if missing, name is "<level>::raw".
If only a single value is provided to the function, without specifying whether it is a name or level, it will be used as the name value.}

\item{level}{character label like "peptide"/"protein" (default "feature").}
}
\value{
A `ProBatchFeatures` object.

A `ProBatchFeatures` object.
}
\description{
Construct a ProBatchFeatures object from a wide matrix + sample annotation.

Construct a ProBatchFeatures object from a wide matrix + sample annotation.
}
\examples{
# Shared setup for ProBatchFeatures documentation examples -----------------
data("example_ecoli_data", package = "proBatch")

# Extract data
all_metadata <- example_ecoli_data$all_metadata
all_precursors <- example_ecoli_data$all_precursors
all_protein_groups <- example_ecoli_data$all_protein_groups
all_precursor_pg_match <- example_ecoli_data$all_precursor_pg_match

# Keep only essential
rm(example_ecoli_data)

# Construct a ProBatchFeatures object --------------------------------------
pbf <- ProBatchFeatures(
    data_matrix = all_precursors,
    sample_annotation = all_metadata,
    sample_id_col = "FullRunName",
    level = "peptide"
)

# Register a custom step and evaluate it -----------------------------------
pb_register_step("add_one", function(x) x + 1)
pb_eval(pbf, from = "peptide::raw", steps = "add_one")

# Derived objects for downstream helpers -----------------------------------
pbf_logged <- pb_transform(
    pbf,
    from = "peptide::raw",
    steps = c("log2", "medianNorm"),
    store_fast_steps = TRUE
)

# Get information about the object ---------------------------------------
get_operation_log(pbf_logged)
get_chain(pbf_logged)
get_chain(pbf_logged, as_string = TRUE)
pb_pipeline_name(pbf_logged) # the latest pipeline
pb_pipeline_name(pbf_logged, assay = "peptide::raw")

# Access assays and matrices ------------------------------------------------
head(pb_current_assay(pbf_logged)) # the latest assay
head(pb_assay_matrix(pbf_logged)) # the latest matrix
head(pb_assay_matrix(pbf_logged, assay = "peptide::raw")) # the latest matrix
head(pb_as_wide(pbf_logged)) # the latest assay in wide format
head(pb_as_long(pbf_logged)) # the latest assay in long format

# Pipeline evaluation without storing --------------------------------------
pb_eval(
    pbf,
    from = "peptide::raw",
    steps = c("log2", "medianNorm")
)

# Long-format constructor ---------------------------------------------------
long_pbf <- pb_as_long(pbf_logged) # the latest assay in long format

ProBatchFeatures_from_long(
    df_long = long_pbf,
    sample_annotation = all_metadata,
    sample_id_col = "FullRunName",
    feature_id_col = "peptide_group_label",
    level = "peptide"
)


# Aggregate and add levels --------------------------------------------------

pb_aggregate_level(
    pbf,
    from = "peptide::raw",
    feature_var = "ProteinName",
    new_level = "protein"
)

# Add proteins as a new level and link via mapping
#    all_precursor_pg_match has columns: "Precursor.Id", "Protein.Ids"
pbf <- pb_add_level(
    object = pbf,
    from = "peptide::raw",
    new_matrix = all_protein_groups,
    to_level = "protein", # will name "protein::raw" by default
    mapping_df = all_precursor_pg_match,
    from_id = "Precursor.Id",
    to_id = "Protein.Ids",
    map_strategy = "as_is"
)
}
